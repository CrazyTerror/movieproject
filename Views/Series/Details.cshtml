@model MovieProject.Models.Series
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = @Model.Name + " (" + ViewBag.Year + ")";
}

<div class="row">
    <img src="/images/filmitem/@(Model.Id).jpg" onerror="this.src='/images/filmitem/template.jpg';this.onerror='';" alt="@Model.Name" width="100%">
</div>

<div>
    <ul>
        <li>
            <label>Average</label>
            @if (@Model.VoteAverage != null) { @Model.VoteAverage } else { <text>No votes</text> }
        </li>
        <li>
            <label>Votes</label>
            @if (@Model.VoteCount != null) { @Model.VoteCount } else { <text>No votes</text> }
        </li>
        @if (User.Identity.IsAuthenticated)
        {
            @await Html.PartialAsync("_RatingPartial", Model)
        }
        <li>
            <label>Premiered</label> @ViewBag.Premiere
        </li>
        <li>
            <label>Runtime</label> @ViewBag.TotalRuntime
        </li>
        <li>
            <label>Genres</label>
            @String.Join(", ", ViewBag.Genres)
            @if (User.Identity.IsAuthenticated) { <a asp-action="Genre">Edit</a> }
        </li>
        <li>
            <label>Status</label> @Model.Status
        </li>
    </ul>
</div>

@foreach (var season in @Model.Seasons.OrderBy(s => s.Season_SeasonNumber))
{
    <div>
        <a asp-action="Details" asp-controller="Season" asp-route-seasonnumber="@season.Season_SeasonNumber">
            <img src="/images/filmitem/poster/@(season.Id).jpg" onerror="this.src='/images/filmitem/poster/template.jpg';this.onerror='';" alt="@season.Name" width="200px" height="300px"/>
        </a>
        <div>@(season.Episodes.Count) episodes</div>
    </div>
}

@if (Model.Videos.Count > 0)
{
    <h4>Videos</h4>
    @foreach (var video in @Model.Videos)
    {
        <iframe width="560" height="315" src="@video.Path" frameborder="0" allow="accelerometer; encrypted-media; picture-in-picture"></iframe>
        <h6>@video.Description</h6>
    }
}

<div class="row">
    <h2>Actors</h2>
    @if (User.Identity.IsAuthenticated) { <a asp-action="Credits">Edit</a> }
    @foreach (var item in @Model.FilmItemCredits.Where(f => f.PartType == PartType.Cast).OrderBy(o => o.Person.Surname))
    {
        <a asp-action="Details" asp-controller="Person" asp-route-slug="@item.Person.Slug">
            <img src="/images/person/poster/@(item.Person.Id).jpg" onerror="this.src='/images/person/poster/template.jpg';this.onerror='';" alt="@item.Person.FirstName @item.Person.Surname" height="127px" width="84px" />
        </a>
        <div>@item.Person.FirstName @item.Person.Surname</div>
        <div>@item.Character</div><br />
    }
</div>

<div>
    @Model.Seasons.Count @(@Model.Seasons.Count > 1 || Model.Seasons.Count == 0 ? "Seasons" : "Season" )
</div>

@if (User.Identity.IsAuthenticated)
{
    <div class="text-center">
        <a asp-controller="Season" asp-action="Create" class="btn btn-primary">Add Season</a>
    </div>
}

@await Html.PartialAsync("_CommentPartial", Model)

<div>
    <img src="/images/filmitem/poster/@(Model.Id).jpg" onerror="this.src='/images/filmitem/poster/template.jpg';this.onerror='';" alt="@Model.Name">
</div>

@section Scripts
{
    <script>
        var select = '';
        for (i=1; i<=10; i++)
        {
            select += '<option val=' + i + '>' + i + '</option>';
        }
        $('#rating').html(select);
    </script>
}