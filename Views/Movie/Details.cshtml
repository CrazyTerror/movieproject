@model MovieProject.Models.Movie
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = @Model.Name + " (" + ViewBag.Year + ")";
}

<div class="row">
    <img src="/images/filmitem/@(Model.Id).jpg" onerror="this.src='/images/filmitem/template.jpg';this.onerror='';" alt="@Model.Name" width="100%">
</div>
<div class="row">
    <div class="col-md-10">
        <ul>
            <li>
                <label>Average</label>
                @if (@Model.VoteAverage != null) { @Model.VoteAverage } else { <text>No votes</text> }
            </li>
            <li>
                <label>Votes</label>
                @if (@Model.VoteCount != null) { @Model.VoteCount } else { <text>No votes</text> }
            </li>
            @if (User.Identity.IsAuthenticated)
            {
                @await Html.PartialAsync("_FilmItemRatingPartial", Model)
            }
        </ul>
    </div>
</div>

<div>
    <ul>
        <li>
            <label>Released</label> @ViewBag.Date
        </li>
        <li>
            <label>Runtime</label> @Model.Runtime
        </li>
        <li>
            <label>Genres</label>
            @String.Join(", ", ViewBag.Genres)
            @if (User.Identity.IsAuthenticated) { <a asp-action="Genre">Edit</a> }
        </li>
        <li>
            <label>Status</label> @Model.Status
        </li>
        @if (Model.FilmItemCredits.Where(p => p.PartType == PartType.Director).ToList().Count > 0)
        {
            <li>
                <label>Director</label>
                @Html.Raw(string.Join(", ", Model.FilmItemCredits.Where(p => p.PartType == PartType.Director).OrderBy(x => x.Person.Surname).Select(s => string.Format("<a href={0}>{1}{2}{3}</a>", "/person/" + s.Person.Slug, s.Person.FirstName, " ", s.Person.Surname))))
            </li>
        }
        @if (Model.FilmItemCredits.Where(p => p.PartType == PartType.Producer).ToList().Count > 0)
        {
            <li>
                <label>Director</label>
                @String.Join(", ", ViewBag.Producers)
            </li>
        }
        @if (Model.FilmItemCredits.Where(p => p.PartType == PartType.Writer).ToList().Count > 0)
        {
            <li>
                <label>Director</label>
                @String.Join(", ", ViewBag.Writers)
            </li>
        }
    </ul>
</div>

@if (User.Identity.IsAuthenticated)
{
    <div id="modal-placeholder"></div>
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" data-url="@Url.Action("ListsModal", new { Slug = Model.Slug })">
        Add To List
    </button>
}

@await Html.PartialAsync("_FilmItemVideoPartial", Model)

@await Html.PartialAsync("_FilmItemCastPartial", Model)

@await Html.PartialAsync("_FilmItemCommentPartial", Model)

@await Html.PartialAsync("_FilmItemListsPartial", Model)

@await Html.PartialAsync("_MediaPartial", Model.Media)

<div>
    <img src="/images/filmitem/poster/@(Model.Id).jpg" onerror="this.src='/images/filmitem/poster/template.jpg';this.onerror='';" alt="@Model.Name">
</div>

@section Scripts
{
    <script>
        var select = '';
        for (i=1; i<=10; i++)
        {
            select += '<option val=' + i + '>' + i + '</option>';
        }
        $('#rating').html(select);
    </script>
}